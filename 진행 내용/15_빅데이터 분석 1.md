# 빅데이터 분석 1

- Impala(임팔라)
- Zeppelin(제플린)
- Mahout(머하웃)
- Sqoop(스쿱)

> 각각 구성

<hr>

## Impala 이용
> 기존 Hive에서 30초 이상 걸렸던 걸과가 파일럿 환경에서 2초 내로 조회되면서 **대화형 분석**이 가능해진다.

`select * from managed_smartcar_symptom_info where biz_date = '20210901'`

- 긴급 점검이 필요한 스마트카 정보 조회

`select * from Managed_SmartCar_Emergency_Check_Info where biz_date = '20210901'`

- 스마트카 차량정보 조회

`select * from managed_smartcar_item_buylist_info where biz_month = '202109'`

<hr>

#### 운행 지역 분석

```
select T2.area_number, T2.car_number, T2.speed_avg

from (
    select
        T1.area_number,
        T1.car_number,
        T1.speed_avg,
        rank() over(partition by T1.area_number order by T1.speed_avg desc) as ranking
    from ( 
        select area_number, car_number, avg(cast(speed as int)) as speed_avg
        from managed_smartcar_drive_info
        group by area_number, car_number
    ) T1
) T2
where ranking = 1
```

- rank()를 통해 지역마다 평균 속도가 높은 순서대로 순위를 매기게 된다.
- ranking이 1인 (가속을 가장 많이 한 차량을 뽑는다)

## Zeppelin

- 제플린 시작
`zeppelin-daemon.sh start`
- 제플린 상태 
`zeppelin-daemon.sh status`

> http://server02.hadoop.com:8081

![image](https://user-images.githubusercontent.com/43158502/135637485-a4297bda-48e7-46fc-987a-21e9659e3620.png)

![image](https://user-images.githubusercontent.com/43158502/136148816-80002803-67ae-488b-9e7b-b1090bb15f0c.png)

![image](https://user-images.githubusercontent.com/43158502/136148889-0bb0c0d9-a146-4345-a181-ba29427fdd84.png)


![image](https://user-images.githubusercontent.com/43158502/136148874-1dd0f5ab-0991-42ba-b625-5c83d8aeba64.png)

## 스마트카 차량 용품 추천

- Mahout 추천 시스템

![image](https://user-images.githubusercontent.com/43158502/136193378-d331d8b1-a50f-437b-8dd3-f9e5238320cf.png)

- 예측, 목표 변수 정상적으로 만들어졌는지 확인

![image](https://user-images.githubusercontent.com/43158502/136193409-f8613d74-ca44-4383-8340-72c7de309bfe.png)

`$ hdfs dfs -mkdir -p /pilot-pjt/mahout/recommendation/input`

`$ hdfs dfs -put /home/pilot-pjt/mahout-data/recommendation/input/* /pilot-pjt/mahout/recommendation/input/item_buylist.txt`


![image](https://user-images.githubusercontent.com/43158502/136193230-26ba78e7-308a-4a13-abf5-7d4efccd8ad1.png)

![image](https://user-images.githubusercontent.com/43158502/136193250-adfd4140-39c5-4b92-8577-8d9f136288c6.png)
